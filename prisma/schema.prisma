generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // mysql / sqlite ise deÄŸiÅŸtir
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
  SUPER_ADMIN
}

model User {
  id        String   @id @default(uuid())
  username  String   @unique
  email     String   @unique
  password  String
  role      Role     @default(USER)

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  ownedCustomers Customer[] @relation("CustomerOwner")

  refreshTokens RefreshToken[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([organizationId])
}

model RefreshToken {
  id           String   @id @default(uuid())
  refreshToken String   @unique
  expiredAt    DateTime

  userId String
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)
}


model Organization {
  id String @id @default(uuid())

  // Identity
  name             String
  slug             String           @unique
  organizationType OrganizationType

  // Business info
  legalName String?
  industry  String?
  website   String?
  email     String?
  phone     String?

  // Subscription
  planType PlanType @default(FREE)
  isActive Boolean  @default(true)

  // Ownership (Auth / Super Admin)
  ownerUserId String

  // Relations
  users      User[]
  customers  Customer[]
  activities Activity[]
  tasks      Task[]

  // Audit
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([ownerUserId])
  @@index([isActive])
  @@index([deletedAt])
}


enum OrganizationType {
  COMPANY
  CLUB
  NGO
}

enum PlanType {
  FREE
  PRO
  ENTERPRISE
}

model Customer {
  id String @id @default(uuid())

  // Multi-tenant
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  // Ownership (CRM iÃ§i sorumlu)
  ownerUserId String
  owner       User @relation("CustomerOwner", fields: [ownerUserId], references: [id])

  // Personal / Company Info
  firstName   String
  lastName    String
  email       String?
  phone       String?
  companyName String?
  vatNumber   String?
  website     String?
  address     String?
  description String?

  // CRM lifecycle
  status CustomerStatus @default(LEAD)

  // Relations
  activities Activity[]
  tasks      Task[]

  // Audit
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([organizationId])
  @@index([ownerUserId])
  @@index([status])
  @@index([deletedAt])
}



enum CustomerStatus {
  LEAD
  ACTIVE
  INACTIVE
}

model Task {
  id String @id @default(uuid())

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  customerId String?
  customer   Customer? @relation(fields: [customerId], references: [id])

  title       String
  description String?

  status  TaskStatus @default(OPEN)
  dueDate DateTime?

  activities Activity[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([organizationId])
  @@index([customerId])
  @@index([status])
  @@index([deletedAt])
}

enum TaskStatus {
  OPEN
  IN_PROGRESS
  DONE
}

model Activity {
  id String @id @default(uuid())

  // ðŸ”— Relations
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  customerId String?
  customer   Customer? @relation(fields: [customerId], references: [id])

  taskId String?
  task   Task?   @relation(fields: [taskId], references: [id])

  // ðŸ§  Activity Info
  type        ActivityType
  title       String
  description String?

  // ðŸ‘¤ Auth (ileride)
  createdByUserId String?

  // ðŸ•’ Audit
  createdAt DateTime  @default(now())
  deletedAt DateTime?

  @@index([organizationId])
  @@index([customerId])
  @@index([taskId])
  @@index([type])
  @@index([deletedAt])
}

enum ActivityType {
  CALL
  EMAIL
  NOTE
  MEETING
  TASK_CREATED
  TASK_COMPLETED
  STATUS_CHANGE
}
